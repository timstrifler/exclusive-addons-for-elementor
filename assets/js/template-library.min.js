!function(l,s){window.exad=window.exad||{},exad.translate=function(e,t){return elementorCommon.translate(e,null,t,ExclusiveAddonsEditor.i18n)};var d={LibraryViews:{},LibraryModels:{},LibraryCollections:{},LibraryBehaviors:{},LibraryLayout:null,LibraryManager:null};d.LibraryModels.Template=Backbone.Model.extend({defaults:{template_id:0,title:"",type:"",thumbnail:"",url:"",isPro:!1,category:[]}}),d.LibraryCollections.Template=Backbone.Collection.extend({model:d.LibraryModels.Template}),d.LibraryBehaviors.InsertTemplate=Marionette.Behavior.extend({ui:{insertButton:".exad-templateLibrary-insert-button"},events:{"click @ui.insertButton":"onInsertButtonClick"},onInsertButtonClick:function(){exad.library.insertTemplate({model:this.view.model})}}),d.LibraryViews.Loading=Marionette.ItemView.extend({template:"#template-exad-templateLibrary-loading",id:"exad-templateLibrary-loading"}),d.LibraryViews.Logo=Marionette.ItemView.extend({template:"#template-exad-templateLibrary-header-logo",className:"exad-templateLibrary-header-logo",templateHelpers:function(){return{title:this.getOption("title")}}}),d.LibraryViews.BackButton=Marionette.ItemView.extend({template:"#template-exad-templateLibrary-header-back",id:"elementor-template-library-header-preview-back",className:"exad-templateLibrary-header-back",events:function(){return{click:"onClick"}},onClick:function(){exad.library.showBlocksView()}}),d.LibraryViews.EmptyTemplateCollection=Marionette.ItemView.extend({id:"elementor-template-library-templates-empty",template:"#template-exad-templateLibrary-empty",ui:{title:".elementor-template-library-blank-title",message:".elementor-template-library-blank-message"},modesStrings:{empty:{title:exad.translate("templatesEmptyTitle"),message:exad.translate("templatesEmptyMessage")},noResults:{title:exad.translate("templatesNoResultsTitle"),message:exad.translate("templatesNoResultsMessage")}},getCurrentMode:function(){return exad.library.getFilter("text")?"noResults":"empty"},onRender:function(){var e=this.modesStrings[this.getCurrentMode()];this.ui.title.html(e.title),this.ui.message.html(e.message)}}),d.LibraryViews.Actions=Marionette.ItemView.extend({template:"#template-exad-templateLibrary-header-actions",id:"elementor-template-library-header-actions",ui:{sync:"#exad-templateLibrary-header-sync i"},events:{"click @ui.sync":"onSyncClick"},onSyncClick:function(){var e=this;e.ui.sync.addClass("eicon-animation-spin"),exad.library.requestLibraryData({onUpdate:function(){e.ui.sync.removeClass("eicon-animation-spin"),exad.library.updateBlocksView()},forceUpdate:!0,forceSync:!0})}}),d.LibraryViews.InsertWrapper=Marionette.ItemView.extend({template:"#template-exad-templateLibrary-header-insert",id:"elementor-template-library-header-preview",behaviors:{insertTemplate:{behaviorClass:d.LibraryBehaviors.InsertTemplate}}}),d.LibraryViews.Preview=Marionette.ItemView.extend({template:"#template-exad-templateLibrary-preview",className:"exad-templateLibrary-preview",ui:function(){return{iframe:"> iframe"}},onRender:function(){this.ui.iframe.attr("src",this.getOption("url")).hide();var e=this,t=(new d.LibraryViews.Loading).render();this.$el.append(t.el),this.ui.iframe.on("load",function(){e.$el.find("#exad-templateLibrary-loading").remove(),e.ui.iframe.show()})}}),d.LibraryViews.TemplateCollection=Marionette.CompositeView.extend({template:"#template-exad-templateLibrary-templates",id:"exad-templateLibrary-templates",childViewContainer:"#exad-templateLibrary-templates-list",emptyView:function(){return new d.LibraryViews.EmptyTemplateCollection},ui:{templatesWindow:".exad-templateLibrary-templates-window",textFilter:"#exad-templateLibrary-search",categoryFilter:"#exad-templateLibrary-filter-category",filterBar:"#exad-templateLibrary-toolbar-filter"},events:{"input @ui.textFilter":"onTextFilterInput","change @ui.categoryFilter":"onCategoryFilterClick"},getChildView:function(e){return d.LibraryViews.Template},initialize:function(){this.listenTo(exad.library.channels.templates,"filter:change",this._renderChildren)},filter:function(r){var e=exad.library.getFilterTerms(),n=!0;return _.each(e,function(e,t){var a=exad.library.getFilter(t);if(a&&e.callback){var i=e.callback.call(r,a);return i||(n=!1),i}}),n},setMasonrySkin:function(){var e=new elementorModules.utils.Masonry({container:this.$childViewContainer,items:this.$childViewContainer.children()});this.$childViewContainer.imagesLoaded(e.run.bind(e))},onRenderCollection:function(){this.setMasonrySkin(),this.updatePerfectScrollbar()},onTextFilterInput:function(){var e=this;_.defer(function(){exad.library.setFilter("text",e.ui.textFilter.val())})},onCategoryFilterClick:function(e){var t=e.currentTarget.selectedOptions[0].value;exad.library.setFilter("category",t)},updatePerfectScrollbar:function(){this.perfectScrollbar||(this.perfectScrollbar=new PerfectScrollbar(this.ui.templatesWindow[0],{suppressScrollX:!0})),this.perfectScrollbar.isRtl=!1,this.perfectScrollbar.update()},onRender:function(){this.$("#exad-templateLibrary-filter-category").select2({placeholder:"Filter By Widget",allowClear:!0,width:200}),this.updatePerfectScrollbar()}}),d.LibraryViews.Template=Marionette.ItemView.extend({template:"#template-exad-templateLibrary-template",className:"exad-templateLibrary-template",ui:{previewButton:".exad-templateLibrary-preview-button, .exad-templateLibrary-template-preview"},events:{"click @ui.previewButton":"onPreviewButtonClick"},behaviors:{insertTemplate:{behaviorClass:d.LibraryBehaviors.InsertTemplate}},onPreviewButtonClick:function(){exad.library.showPreviewView(this.model)}}),d.Modal=elementorModules.common.views.modal.Layout.extend({getModalOptions:function(){return{id:"exadTemplateLibraryModal",hide:{onOutsideClick:!1,onEscKeyPress:!0,onBackgroundClick:!1}}},getTemplateActionButton:function(e){var t=e.isPro&&!ExclusiveAddonsEditor.isProActive?"pro-button":"insert-button";return viewId="#template-exad-templateLibrary-"+t,template=Marionette.TemplateCache.get(viewId),Marionette.Renderer.render(template)},showLogo:function(e){this.getHeaderView().logoArea.show(new d.LibraryViews.Logo(e))},showDefaultHeader:function(){this.showLogo({title:"Exclusive Addons"}),this.getHeaderView().tools.show(new d.LibraryViews.Actions)},showPreviewView:function(e){var t=this.getHeaderView();t.logoArea.show(new d.LibraryViews.BackButton),t.tools.show(new d.LibraryViews.InsertWrapper({model:e})),this.modalContent.show(new d.LibraryViews.Preview({url:e.get("url")}))},showBlocksView:function(e){this.modalContent.show(new d.LibraryViews.TemplateCollection({collection:e}))}}),d.LibraryManager=function(){function r(){var e=l(this).closest(".elementor-top-section"),a=e.data("model-cid"),t=window.elementor.sections;t.currentView.collection.length&&_.each(t.currentView.collection.models,function(e,t){a===e.cid&&(o.atIndex=t)}),e.prev(".elementor-add-section").find(FIND_SELECTOR).before($exadLibraryButton)}function e(){var a=window.elementor.$previewContents,i=setInterval(function(){var e,t;(t=(e=a).find(FIND_SELECTOR)).length&&t.before($exadLibraryButton),e.on("click.onAddElement",".elementor-editor-section-settings .elementor-editor-element-add",r),0<a.find(".elementor-add-new-section").length&&clearInterval(i)},100);a.on("click.onAddTemplateButton",".elementor-add-exad-button",o.showModal.bind(o))}var t,a,i,n,o=this;FIND_SELECTOR=".elementor-add-new-section .elementor-add-section-drag-title",$exadLibraryButton='<div class="elementor-add-section-area-button elementor-add-exad-button"><i class="exad exad-logo"></i></div>',this.atIndex=-1,this.channels={templates:Backbone.Radio.channel("templates")},this.updateBlocksView=function(){o.setFilter("category","",!0),o.setFilter("text","",!0),o.getModal().showBlocksView(i)},this.setFilter=function(e,t,a){o.channels.templates.reply("filter:"+e,t),a||o.channels.templates.trigger("filter:change")},this.getFilter=function(e){return o.channels.templates.request("filter:"+e)},this.getFilterTerms=function(){return{category:{callback:function(t){return _.any(this.get("category"),function(e){return 0<=e.indexOf(t)})}},text:{callback:function(t){return t=t.toLowerCase(),0<=this.get("title").toLowerCase().indexOf(t)||_.any(this.get("category"),function(e){return 0<=e.indexOf(t)})}}}},this.showModal=function(){o.getModal().showModal(),o.showBlocksView()},this.closeModal=function(){this.getModal().hideModal()},this.getModal=function(){return t=t||new d.Modal},this.init=function(){s.on("preview:loaded",e.bind(this))},this.getCategory=function(){return a},this.showBlocksView=function(){o.getModal().showDefaultHeader(),o.setFilter("category","",!0),o.loadTemplates(function(){o.getModal().showBlocksView(i)})},this.showPreviewView=function(e){o.getModal().showPreviewView(e)},this.loadTemplates=function(e){o.requestLibraryData({onBeforeUpdate:o.getModal().showLoadingView.bind(o.getModal()),onUpdate:function(){o.getModal().hideLoadingView(),e&&e()}})},this.requestLibraryData=function(t){var e;!i||t.forceUpdate?(t.onBeforeUpdate&&t.onBeforeUpdate(),e={data:{},success:function(e){i=new d.LibraryCollections.Template(e.templates),e.category&&(a=e.category),t.onUpdate&&t.onUpdate()}},t.forceSync&&(e.data.sync=!0),elementorCommon.ajax.addRequest("exad_get_template_library_data",e)):t.onUpdate&&t.onUpdate()},this.requestTemplateData=function(e,t){var a={unique_id:e,data:{edit_mode:!0,display:!0,template_id:e}};t&&jQuery.extend(!0,a,t),elementorCommon.ajax.addRequest("exad_get_template_item_data",a)},this.insertTemplate=function(e){var a=e.model,i=this;i.getModal().showLoadingView(),i.requestTemplateData(a.get("template_id"),{success:function(e){i.getModal().hideLoadingView(),i.getModal().hideModal();var t={};-1!==i.atIndex&&(t.at=i.atIndex),$e.run("document/elements/import",{model:a,data:e,options:t}),i.atIndex=-1},error:function(e){i.showErrorDialog(e)},complete:function(e){i.getModal().hideLoadingView()}})},this.showErrorDialog=function(e){var t;"object"==typeof e?(t="",_.each(e,function(e){t+="<div>"+e.message+".</div>"}),e=t):e?e+=".":e="<i>&#60;The error message is empty&#62;</i>",o.getErrorDialog().setMessage('The following error(s) occurred while processing the request:<div id="elementor-template-library-error-info">'+e+"</div>").show()},this.getErrorDialog=function(){return n=n||elementorCommon.dialogsLibraryManager.createWidget("alert",{id:"elementor-template-library-error-dialog",headerMessage:"An error occurred"})}},window.exad.library=new d.LibraryManager,window.exad.library.init()}(jQuery,window.elementor);